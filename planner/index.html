<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Planner ‚Äì Uni Hyper Notes</title>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#0a0a0f;--bg2:#12121a;--bg3:#1a1a26;--border:#2a2a3d;--border-glow:#5b6ef5;
  --text:#e8e8f0;--text-muted:#7070a0;--text-dim:#4a4a6a;
  --accent:#5b6ef5;--accent2:#8b5cf6;
  --green:#22c55e;--red:#ef4444;--yellow:#eab308;--orange:#f97316;--cyan:#06b6d4;
  --card-radius:12px;--trans:all 0.22s cubic-bezier(.4,0,.2,1);
  --hour-h:64px;
}
html{font-size:15px}
body{background:var(--bg);color:var(--text);font-family:'Segoe UI',system-ui,-apple-system,sans-serif;min-height:100vh;overflow-x:hidden}
::-webkit-scrollbar{width:6px;height:6px}
::-webkit-scrollbar-track{background:var(--bg2)}
::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
::-webkit-scrollbar-thumb:hover{background:var(--accent)}
.page{max-width:1160px;margin:0 auto;padding:28px 24px 60px}

/* HEADER */
.header{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:28px;gap:16px;flex-wrap:wrap}
.header-left h1{font-size:1.9rem;font-weight:700;display:flex;align-items:center;gap:10px;letter-spacing:-.3px}
.icon-badge{width:36px;height:36px;background:linear-gradient(135deg,var(--accent),var(--accent2));border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:1rem;box-shadow:0 0 14px rgba(91,110,245,.45);flex-shrink:0}
.header-left p{color:var(--text-muted);font-size:.85rem;margin-top:5px;margin-left:46px}
.header-right{display:flex;align-items:center;gap:10px;flex-shrink:0}

/* STREAK */
.streak-badge{background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:8px 14px;display:flex;align-items:center;gap:8px;font-size:.82rem;transition:var(--trans);cursor:default}
.streak-badge:hover{border-color:var(--yellow);box-shadow:0 0 12px rgba(234,179,8,.25);transform:translateY(-2px)}
.streak-badge .num{font-size:1.3rem;font-weight:700;color:var(--yellow);line-height:1}
.streak-badge .label{color:var(--text-muted);line-height:1.3}
.streak-badge .label span{display:block;font-size:.7rem}

/* STATS */
.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:24px}
@media(max-width:700px){.stats-grid{grid-template-columns:repeat(2,1fr)}}
.stat-card{background:var(--bg2);border:1px solid var(--border);border-radius:var(--card-radius);padding:18px 18px 14px;transition:var(--trans);cursor:default}
.stat-card:hover{border-color:var(--border-glow);box-shadow:0 0 18px rgba(91,110,245,.2);transform:translateY(-3px)}
.stat-card .val{font-size:2rem;font-weight:700;line-height:1;margin-bottom:6px}
.stat-card .lbl{color:var(--text-muted);font-size:.82rem}
.stat-card .sub{font-size:.75rem;margin-top:5px;display:flex;align-items:center;gap:4px}
.stat-card .sub.good{color:var(--green)}.stat-card .sub.warn{color:var(--yellow)}.stat-card .sub.bad{color:var(--red)}

/* FOCUS */
.focus-banner{background:linear-gradient(135deg,rgba(91,110,245,.12),rgba(139,92,246,.12));border:1px solid rgba(91,110,245,.3);border-radius:var(--card-radius);padding:14px 18px;display:flex;align-items:center;gap:14px;margin-bottom:20px;animation:pulseGlow 3s infinite}
@keyframes pulseGlow{0%,100%{box-shadow:0 0 10px rgba(91,110,245,.15)}50%{box-shadow:0 0 25px rgba(91,110,245,.35)}}
.focus-timer{font-size:2rem;font-weight:700;font-variant-numeric:tabular-nums;background:linear-gradient(135deg,var(--accent),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent;min-width:90px}
.focus-info{flex:1}.focus-info .focus-label{font-size:.82rem;color:var(--text-muted)}.focus-info .focus-task{font-size:.93rem;font-weight:500}

/* TOOLBAR */
.toolbar{display:flex;gap:10px;margin-bottom:18px;flex-wrap:wrap}
.search-wrap{flex:1;min-width:200px;position:relative}
.search-wrap .ico{position:absolute;left:12px;top:50%;transform:translateY(-50%);color:var(--text-dim);pointer-events:none}
.search-wrap input{width:100%;background:var(--bg2);border:1px solid var(--border);border-radius:8px;padding:9px 12px 9px 36px;color:var(--text);font-size:.88rem;outline:none;transition:var(--trans)}
.search-wrap input:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(91,110,245,.15)}
.search-wrap input::placeholder{color:var(--text-dim)}
.filter-select{background:var(--bg2);border:1px solid var(--border);border-radius:8px;padding:9px 28px 9px 12px;color:var(--text);font-size:.88rem;outline:none;cursor:pointer;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%237070a0' d='M6 8L1 3h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 10px center;transition:var(--trans)}
.filter-select:hover,.filter-select:focus{border-color:var(--accent)}

/* TABS */
.tabs{display:flex;gap:8px;margin-bottom:22px;flex-wrap:wrap}
.tab-btn{background:var(--bg2);border:1px solid var(--border);border-radius:8px;padding:8px 18px;color:var(--text-muted);font-size:.88rem;cursor:pointer;transition:var(--trans);display:flex;align-items:center;gap:7px;user-select:none;white-space:nowrap}
.tab-btn:hover{color:var(--text);border-color:var(--accent);box-shadow:0 0 12px rgba(91,110,245,.2);transform:translateY(-2px)}
.tab-btn.active{background:linear-gradient(135deg,var(--accent),var(--accent2));border-color:transparent;color:#fff;box-shadow:0 0 18px rgba(91,110,245,.4)}
.tab-btn.active:hover{transform:translateY(-2px)}

/* PANELS */
.panel{display:none;animation:fadeSlide .28s ease}.panel.active{display:block}
@keyframes fadeSlide{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

/* SECTION HEADER */
.section-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
.section-title{font-size:1rem;font-weight:600;color:var(--text-muted);display:flex;align-items:center;gap:7px}
.section-title::before{content:'';display:inline-block;width:3px;height:14px;background:linear-gradient(to bottom,var(--accent),var(--accent2));border-radius:2px}

/* TASK CARDS */
.tasks-list{display:flex;flex-direction:column;gap:10px}
.task-card{background:var(--bg2);border:1px solid var(--border);border-radius:var(--card-radius);padding:14px 16px;display:flex;align-items:center;gap:12px;transition:var(--trans);cursor:pointer;position:relative;overflow:hidden}
.task-card::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;border-radius:4px 0 0 4px}
.task-card.prio-high::before{background:var(--red)}.task-card.prio-mid::before{background:var(--yellow)}.task-card.prio-low::before{background:var(--green)}
.task-card:hover{border-color:var(--border-glow);box-shadow:0 0 18px rgba(91,110,245,.2);transform:translateY(-2px)}
.task-card.done{opacity:.5}.task-card.done .task-title{text-decoration:line-through;color:var(--text-muted)}
.task-check{width:20px;height:20px;flex-shrink:0;border:2px solid var(--border);border-radius:6px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:var(--trans);background:transparent}
.task-check:hover{border-color:var(--accent)}
.task-check.checked{background:var(--green);border-color:var(--green);box-shadow:0 0 10px rgba(34,197,94,.4)}
.task-check.checked::after{content:'‚úì';color:#fff;font-size:.75rem;font-weight:700}
.task-body{flex:1;min-width:0}.task-title{font-size:.9rem;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.task-meta{display:flex;align-items:center;gap:8px;margin-top:4px;flex-wrap:wrap}
.tag{font-size:.72rem;padding:2px 8px;border-radius:20px;font-weight:500;border:1px solid transparent}
.tag-blue{background:rgba(91,110,245,.15);color:#8b9cf9;border-color:rgba(91,110,245,.25)}
.tag-purple{background:rgba(139,92,246,.15);color:#b57bf5;border-color:rgba(139,92,246,.25)}
.tag-green{background:rgba(34,197,94,.12);color:#4ade80;border-color:rgba(34,197,94,.2)}
.tag-yellow{background:rgba(234,179,8,.12);color:#fbbf24;border-color:rgba(234,179,8,.2)}
.tag-gray{background:rgba(112,112,160,.1);color:var(--text-muted);border-color:var(--border)}
.task-due{font-size:.75rem;color:var(--text-dim);margin-left:auto;flex-shrink:0}
.task-due.overdue{color:var(--red)}.task-due.today{color:var(--yellow)}.task-due.soon{color:var(--orange)}
.prio-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.prio-dot.high{background:var(--red);box-shadow:0 0 6px rgba(239,68,68,.6)}
.prio-dot.mid{background:var(--yellow);box-shadow:0 0 6px rgba(234,179,8,.6)}
.prio-dot.low{background:var(--green);box-shadow:0 0 6px rgba(34,197,94,.5)}
.btn-add-task{display:flex;align-items:center;gap:8px;background:transparent;border:1px dashed var(--border);border-radius:var(--card-radius);padding:12px 16px;color:var(--text-dim);font-size:.88rem;cursor:pointer;transition:var(--trans);width:100%}
.btn-add-task:hover{border-color:var(--accent);color:var(--accent);background:rgba(91,110,245,.06);box-shadow:0 0 12px rgba(91,110,245,.15)}
.btn-add-task .plus{width:22px;height:22px;border-radius:6px;background:rgba(91,110,245,.12);display:flex;align-items:center;justify-content:center;color:var(--accent);transition:var(--trans)}
.btn-add-task:hover .plus{background:var(--accent);color:#fff;box-shadow:0 0 10px rgba(91,110,245,.5)}

/* BUTTONS */
.btn{display:inline-flex;align-items:center;gap:7px;padding:8px 16px;border-radius:8px;font-size:.85rem;font-weight:500;cursor:pointer;transition:var(--trans);border:1px solid transparent;white-space:nowrap}
.btn-primary{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;box-shadow:0 0 14px rgba(91,110,245,.3)}
.btn-primary:hover{box-shadow:0 0 22px rgba(91,110,245,.55);transform:translateY(-2px)}
.btn-ghost{background:var(--bg3);color:var(--text-muted);border-color:var(--border)}
.btn-ghost:hover{color:var(--text);border-color:var(--accent);box-shadow:0 0 12px rgba(91,110,245,.2);transform:translateY(-2px)}
.btn-sm{padding:5px 12px;font-size:.78rem}

/* CALENDAR */
.cal-wrap{background:var(--bg2);border:1px solid var(--border);border-radius:var(--card-radius);overflow:hidden}
.cal-nav{display:flex;align-items:center;justify-content:space-between;padding:14px 18px;border-bottom:1px solid var(--border)}
.cal-nav .month-label{font-size:1rem;font-weight:600}
.cal-nav button{background:var(--bg3);border:1px solid var(--border);border-radius:6px;color:var(--text-muted);width:30px;height:30px;cursor:pointer;font-size:.85rem;transition:var(--trans);display:flex;align-items:center;justify-content:center}
.cal-nav button:hover{border-color:var(--accent);color:var(--text);box-shadow:0 0 8px rgba(91,110,245,.3)}
.cal-weekdays{display:grid;grid-template-columns:repeat(7,1fr);background:var(--bg3);border-bottom:1px solid var(--border)}
.cal-weekdays div{text-align:center;padding:8px 0;font-size:.75rem;color:var(--text-dim);font-weight:600;letter-spacing:.5px;text-transform:uppercase}
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr)}
.cal-day{min-height:80px;padding:6px;border-right:1px solid var(--border);border-bottom:1px solid var(--border);cursor:pointer;transition:var(--trans)}
.cal-day:nth-child(7n){border-right:none}
.cal-day:hover{background:rgba(91,110,245,.07)}
.cal-day.other-month .day-num{color:var(--text-dim)}
.cal-day.today{background:rgba(91,110,245,.08)}
.cal-day.today .day-num{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;width:24px;height:24px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-weight:700;box-shadow:0 0 10px rgba(91,110,245,.5)}
.day-num{font-size:.8rem;font-weight:600;color:var(--text-muted);margin-bottom:4px}
.cal-event{font-size:.65rem;background:rgba(91,110,245,.18);border-radius:3px;padding:1px 4px;color:#8b9cf9;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:2px;display:block}
.cal-event.red{background:rgba(239,68,68,.15);color:#f87171}
.cal-event.green{background:rgba(34,197,94,.12);color:#4ade80}

/* WEEK TASK VIEW */
.week-grid{display:grid;grid-template-columns:52px repeat(7,1fr);background:var(--bg2);border:1px solid var(--border);border-radius:var(--card-radius);overflow:hidden}
.week-day-header{background:var(--bg3);border-bottom:1px solid var(--border);border-right:1px solid var(--border);padding:10px 6px;text-align:center;font-size:.78rem}
.week-day-header .wd-name{color:var(--text-muted);font-weight:600;letter-spacing:.4px}
.week-day-header .wd-num{font-size:1.1rem;font-weight:700;margin-top:2px}
.week-day-header.today .wd-num{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;width:28px;height:28px;border-radius:7px;display:flex;align-items:center;justify-content:center;margin:2px auto 0;box-shadow:0 0 10px rgba(91,110,245,.5)}
.week-time-col{background:var(--bg3);border-right:1px solid var(--border)}
.week-time-label{font-size:.68rem;color:var(--text-dim);text-align:right;padding:0 6px;height:48px;display:flex;align-items:flex-start;padding-top:6px;border-bottom:1px solid var(--border)}
.week-cell{height:48px;border-right:1px solid var(--border);border-bottom:1px solid var(--border);position:relative;transition:background .15s}
.week-cell:hover{background:rgba(91,110,245,.05)}
.week-event{position:absolute;left:2px;right:2px;border-radius:4px;padding:2px 5px;font-size:.67rem;font-weight:500;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;cursor:pointer;transition:var(--trans);z-index:1}
.week-event:hover{filter:brightness(1.2)}
.week-event.blue{background:rgba(91,110,245,.35);color:#a5b4fc;border-left:2px solid var(--accent)}
.week-event.purple{background:rgba(139,92,246,.3);color:#c4b5fd;border-left:2px solid var(--accent2)}
.week-event.green{background:rgba(34,197,94,.22);color:#86efac;border-left:2px solid var(--green)}
.week-event.red{background:rgba(239,68,68,.22);color:#fca5a5;border-left:2px solid var(--red)}
.week-event.yellow{background:rgba(234,179,8,.2);color:#fde68a;border-left:2px solid var(--yellow)}

/* ‚ïê‚ïê‚ïê‚ïê GOALS ‚ïê‚ïê‚ïê‚ïê */
.goals-layout{display:grid;grid-template-columns:repeat(auto-fill,minmax(290px,1fr));gap:16px;align-items:start}

.goal-card{
  background:var(--bg2);border:1px solid var(--border);
  border-radius:var(--card-radius);
  transition:var(--trans);overflow:hidden;
  cursor:pointer;
}
.goal-card:hover{border-color:var(--border-glow);box-shadow:0 0 20px rgba(91,110,245,.2);transform:translateY(-3px)}
.goal-card.expanded{border-color:var(--border-glow);box-shadow:0 0 24px rgba(91,110,245,.18)}
.goal-card.completed{border-color:rgba(34,197,94,.3);box-shadow:0 0 16px rgba(34,197,94,.12)}

/* color accent strip at top */
.goal-strip{height:3px;border-radius:4px 4px 0 0}

.goal-main{padding:16px 18px 14px}
.goal-head{display:flex;align-items:flex-start;gap:11px;margin-bottom:14px}
.goal-icon{width:40px;height:40px;flex-shrink:0;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.15rem}
.goal-info{flex:1;min-width:0}
.goal-title{font-size:.95rem;font-weight:700;line-height:1.3;display:flex;align-items:center;gap:7px;flex-wrap:wrap}
.goal-done-badge{font-size:.68rem;background:rgba(34,197,94,.15);color:#4ade80;border:1px solid rgba(34,197,94,.25);padding:2px 8px;border-radius:20px;font-weight:600;white-space:nowrap}
.goal-deadline{font-size:.75rem;color:var(--text-muted);margin-top:3px;display:flex;align-items:center;gap:4px}
.goal-deadline.urgent{color:var(--orange)}.goal-deadline.overdue{color:var(--red)}.goal-deadline.soon{color:var(--yellow)}

/* progress ring + bar */
.goal-progress-row{display:flex;align-items:center;gap:12px;margin-bottom:12px}
.goal-ring-wrap{flex-shrink:0;position:relative;width:48px;height:48px}
.goal-ring-wrap svg{transform:rotate(-90deg)}
.goal-ring-bg{fill:none;stroke:var(--bg3);stroke-width:4}
.goal-ring-fill{fill:none;stroke-width:4;stroke-linecap:round;transition:stroke-dashoffset .6s cubic-bezier(.4,0,.2,1)}
.goal-ring-pct{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:.72rem;font-weight:800;font-variant-numeric:tabular-nums}

.goal-progress-bar-col{flex:1}
.goal-bar-bg{background:var(--bg3);border-radius:99px;height:6px;overflow:hidden;margin-bottom:5px}
.goal-bar-fill{height:100%;border-radius:99px;transition:width .5s cubic-bezier(.4,0,.2,1);box-shadow:0 0 8px rgba(91,110,245,.3)}
.goal-bar-info{display:flex;justify-content:space-between;font-size:.72rem;color:var(--text-muted)}

/* milestones preview in card */
.goal-milestones-preview{display:flex;flex-direction:column;gap:6px;border-top:1px solid var(--border);padding:10px 18px 14px}
.ms-preview-item{display:flex;align-items:center;gap:9px;font-size:.82rem;color:var(--text-muted);transition:var(--trans)}
.ms-preview-item.done-ms{color:var(--text-dim);text-decoration:line-through}
.ms-mini-check{width:16px;height:16px;flex-shrink:0;border-radius:4px;border:1.5px solid var(--border);display:flex;align-items:center;justify-content:center;transition:var(--trans)}
.ms-mini-check.checked{background:var(--green);border-color:var(--green);box-shadow:0 0 6px rgba(34,197,94,.4)}
.ms-mini-check.checked::after{content:'‚úì';color:#fff;font-size:.6rem;font-weight:800}
.ms-preview-item:hover .ms-mini-check:not(.checked){border-color:var(--accent)}
.ms-more{font-size:.75rem;color:var(--text-dim);padding:0 0 0 25px}

/* expand toggle */
.goal-expand-btn{width:100%;background:transparent;border:none;border-top:1px solid var(--border);padding:9px;color:var(--text-dim);font-size:.75rem;cursor:pointer;transition:var(--trans);display:flex;align-items:center;justify-content:center;gap:5px}
.goal-expand-btn:hover{color:var(--accent);background:rgba(91,110,245,.05)}
.goal-expand-btn .chevron{transition:transform .22s}
.goal-expand-btn.open .chevron{transform:rotate(180deg)}

/* expanded detail */
.goal-detail{display:none;border-top:1px solid var(--border);padding:14px 18px;animation:fadeSlide .2s ease}
.goal-detail.open{display:block}

.ms-full-list{display:flex;flex-direction:column;gap:8px;margin-bottom:14px}
.ms-item{display:flex;align-items:center;gap:10px;padding:9px 12px;background:var(--bg3);border-radius:8px;border:1px solid var(--border);transition:var(--trans);cursor:pointer}
.ms-item:hover{border-color:var(--accent);box-shadow:0 0 10px rgba(91,110,245,.12);transform:translateX(2px)}
.ms-item.done-ms{opacity:.55}
.ms-check{width:20px;height:20px;flex-shrink:0;border-radius:5px;border:2px solid var(--border);display:flex;align-items:center;justify-content:center;transition:var(--trans);background:transparent}
.ms-check:hover{border-color:var(--accent)}
.ms-check.checked{background:var(--green);border-color:var(--green);box-shadow:0 0 8px rgba(34,197,94,.45)}
.ms-check.checked::after{content:'‚úì';color:#fff;font-size:.7rem;font-weight:800}
.ms-label{flex:1;font-size:.86rem;font-weight:500;transition:var(--trans)}
.ms-item.done-ms .ms-label{text-decoration:line-through;color:var(--text-muted)}
.ms-delete-btn{background:none;border:none;color:var(--text-dim);cursor:pointer;font-size:.75rem;padding:2px 5px;border-radius:4px;opacity:0;transition:opacity .15s}
.ms-item:hover .ms-delete-btn{opacity:1}
.ms-delete-btn:hover{color:var(--red);background:rgba(239,68,68,.12)}

.ms-add-row{display:flex;gap:8px;margin-top:4px}
.ms-add-input{flex:1;background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:7px 11px;color:var(--text);font-size:.83rem;outline:none;transition:var(--trans);font-family:inherit}
.ms-add-input:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(91,110,245,.15)}
.ms-add-input::placeholder{color:var(--text-dim)}
.ms-add-btn{background:var(--accent);border:none;border-radius:8px;color:#fff;padding:7px 14px;font-size:.82rem;font-weight:600;cursor:pointer;transition:var(--trans)}
.ms-add-btn:hover{box-shadow:0 0 12px rgba(91,110,245,.5);transform:translateY(-1px)}

.goal-detail-footer{display:flex;gap:8px;margin-top:12px;padding-top:12px;border-top:1px solid var(--border)}
.btn-danger-sm{background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.25);color:#f87171;border-radius:7px;padding:5px 12px;font-size:.78rem;cursor:pointer;transition:var(--trans)}
.btn-danger-sm:hover{background:rgba(239,68,68,.2);box-shadow:0 0 10px rgba(239,68,68,.2)}

/* new goal card */
.goal-card-new{display:flex;align-items:center;justify-content:center;flex-direction:column;gap:8px;border:1px dashed var(--border);min-height:180px;cursor:pointer;transition:var(--trans);border-radius:var(--card-radius)}
.goal-card-new:hover{border-color:var(--accent);box-shadow:0 0 14px rgba(91,110,245,.18);background:rgba(91,110,245,.04)}
.goal-card-new .big-plus{font-size:2rem;color:var(--text-dim);transition:var(--trans)}
.goal-card-new:hover .big-plus,.goal-card-new:hover span{color:var(--accent)}
.goal-card-new span{font-size:.83rem;color:var(--text-dim);transition:var(--trans)}

/* goals summary bar at top */
.goals-summary{display:flex;gap:14px;margin-bottom:20px;flex-wrap:wrap}
.gs-chip{background:var(--bg2);border:1px solid var(--border);border-radius:9px;padding:10px 16px;display:flex;align-items:center;gap:9px;font-size:.83rem;transition:var(--trans)}
.gs-chip:hover{border-color:var(--border-glow);transform:translateY(-1px)}
.gs-chip .gs-num{font-size:1.25rem;font-weight:800;line-height:1}
.gs-chip .gs-lbl{color:var(--text-muted);font-size:.77rem}

/* HABITS */
.habit-card{background:var(--bg2);border:1px solid var(--border);border-radius:var(--card-radius);padding:14px 16px;display:flex;align-items:center;gap:14px;transition:var(--trans);margin-bottom:10px}
.habit-card:hover{border-color:var(--border-glow);box-shadow:0 0 14px rgba(91,110,245,.18);transform:translateY(-2px)}
.habit-icon{width:40px;height:40px;flex-shrink:0;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.2rem}
.habit-body{flex:1}.habit-name{font-size:.9rem;font-weight:500}.habit-streak{font-size:.75rem;color:var(--text-muted);margin-top:2px}
.habit-days{display:flex;gap:4px}
.habit-day{width:26px;height:26px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:.65rem;font-weight:700;cursor:pointer;transition:var(--trans);border:1px solid var(--border);color:var(--text-dim)}
.habit-day:hover{border-color:var(--accent);transform:translateY(-1px)}
.habit-day.done{background:var(--green);border-color:var(--green);color:#fff;box-shadow:0 0 7px rgba(34,197,94,.4)}
.habit-day.today-col{border-color:var(--accent);color:var(--accent)}

/* ‚ïê‚ïê‚ïê‚ïê STUNDENPLAN ‚ïê‚ïê‚ïê‚ïê */
.sub-tabs{display:flex;gap:6px}
.sub-tab{background:var(--bg3);border:1px solid var(--border);border-radius:7px;padding:6px 16px;font-size:.83rem;color:var(--text-muted);cursor:pointer;transition:var(--trans)}
.sub-tab:hover{border-color:var(--accent);color:var(--text)}
.sub-tab.active{background:rgba(91,110,245,.15);border-color:var(--accent);color:var(--accent);font-weight:600}
.sp-panel{display:none}.sp-panel.active{display:block;animation:fadeSlide .22s ease}

/* nav */
.sp-nav{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;gap:12px;flex-wrap:wrap}
.sp-nav-center{display:flex;align-items:center;gap:10px}
.sp-date-label{font-size:1rem;font-weight:600;min-width:220px;text-align:center}
.sp-nav-btn{background:var(--bg3);border:1px solid var(--border);border-radius:7px;color:var(--text-muted);width:32px;height:32px;cursor:pointer;font-size:.9rem;transition:var(--trans);display:flex;align-items:center;justify-content:center}
.sp-nav-btn:hover{border-color:var(--accent);color:var(--text);box-shadow:0 0 8px rgba(91,110,245,.3)}
.today-chip{background:rgba(91,110,245,.12);border:1px solid rgba(91,110,245,.3);color:var(--accent);border-radius:6px;padding:4px 12px;font-size:.78rem;font-weight:600;cursor:pointer;transition:var(--trans)}
.today-chip:hover{background:rgba(91,110,245,.22);box-shadow:0 0 10px rgba(91,110,245,.25)}
.now-chip{display:inline-flex;align-items:center;gap:6px;background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.25);border-radius:20px;padding:3px 12px 3px 8px;font-size:.78rem;color:#fca5a5;font-weight:500}
.now-chip .dot{width:7px;height:7px;border-radius:50%;background:var(--red);box-shadow:0 0 6px rgba(239,68,68,.7);animation:pulseDot 2s infinite}
@keyframes pulseDot{0%,100%{box-shadow:0 0 4px rgba(239,68,68,.6)}50%{box-shadow:0 0 10px rgba(239,68,68,1),0 0 20px rgba(239,68,68,.5)}}

/* schedule wrapper */
.schedule-wrap{background:var(--bg2);border:1px solid var(--border);border-radius:var(--card-radius);overflow:hidden}

/* day column headers (week view) */
.sch-header-row{display:flex;border-bottom:1px solid var(--border);position:sticky;top:0;z-index:10;background:var(--bg2)}
.sch-time-gutter-head{width:58px;min-width:58px;flex-shrink:0;background:var(--bg3);border-right:1px solid var(--border)}
.sch-col-header{flex:1;background:var(--bg3);border-right:1px solid var(--border);padding:10px 6px;text-align:center;cursor:pointer;transition:var(--trans);min-width:0}
.sch-col-header:last-child{border-right:none}
.sch-col-header:hover{background:rgba(91,110,245,.07)}
.sch-col-header .dh-name{font-size:.7rem;font-weight:700;color:var(--text-muted);letter-spacing:.6px;text-transform:uppercase}
.sch-col-header .dh-num{font-size:1.2rem;font-weight:700;margin-top:3px;line-height:1;color:var(--text)}
.sch-col-header.is-today .dh-name{color:var(--accent)}
.sch-col-header.is-today .dh-num{background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent}

/* scrollable body */
.sch-body{overflow-y:auto;max-height:600px;position:relative}
.sch-inner{display:flex}

/* time gutter */
.sch-gutter{width:58px;min-width:58px;flex-shrink:0;position:relative;border-right:1px solid var(--border)}
.sch-hour-label{height:var(--hour-h);display:flex;align-items:flex-start;justify-content:flex-end;padding:6px 8px 0;font-size:.67rem;color:var(--text-dim);position:relative;user-select:none}

/* columns */
.sch-cols{flex:1;position:relative;min-width:0}
.sch-grid-line{position:absolute;left:0;right:0;border-top:1px solid var(--border)}
.sch-grid-line-half{position:absolute;left:0;right:0;border-top:1px dashed rgba(42,42,61,.6)}

/* day columns (week view) */
.sch-day-col-wrap{display:flex;position:absolute;inset:0}
.sch-day-col{flex:1;position:relative;border-right:1px solid var(--border);min-width:0}
.sch-day-col:last-child{border-right:none}
.sch-day-col.is-today{background:rgba(91,110,245,.022)}

/* EVENT BLOCKS */
.sch-event{
  position:absolute;left:3px;right:3px;
  border-radius:8px;padding:7px 10px;
  cursor:pointer;transition:var(--trans);
  overflow:hidden;border-left:3px solid transparent;
  min-height:26px;z-index:2;
}
.sch-event:hover{
  filter:brightness(1.18);
  transform:scaleX(.96) translateY(-1px);
  box-shadow:0 6px 20px rgba(0,0,0,.35);
  z-index:10;
}
.sch-event .ev-title{font-size:.8rem;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;line-height:1.25}
.sch-event .ev-sub{font-size:.7rem;opacity:.8;margin-top:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.sch-event .ev-time{font-size:.68rem;opacity:.65;margin-top:4px;font-variant-numeric:tabular-nums}
.ev-blue  {background:rgba(91,110,245,.28);border-color:#5b6ef5;color:#a5b4fc}
.ev-purple{background:rgba(139,92,246,.28);border-color:#8b5cf6;color:#c4b5fd}
.ev-green {background:rgba(34,197,94,.22); border-color:#22c55e;color:#86efac}
.ev-red   {background:rgba(239,68,68,.22); border-color:#ef4444;color:#fca5a5}
.ev-yellow{background:rgba(234,179,8,.2);  border-color:#eab308;color:#fde68a}
.ev-cyan  {background:rgba(6,182,212,.22); border-color:#06b6d4;color:#67e8f9}
.ev-pink  {background:rgba(236,72,153,.22);border-color:#ec4899;color:#f9a8d4}
.ev-orange{background:rgba(249,115,22,.22);border-color:#f97316;color:#fdba74}
.ev-delete{position:absolute;top:4px;right:6px;background:rgba(0,0,0,.3);border:none;border-radius:4px;color:rgba(255,255,255,.6);font-size:.68rem;cursor:pointer;padding:1px 5px;opacity:0;transition:opacity .15s}
.sch-event:hover .ev-delete{opacity:1}
.ev-delete:hover{background:rgba(239,68,68,.5);color:#fff}

/* TIME INDICATOR */
.time-indicator{position:absolute;left:0;right:0;z-index:20;pointer-events:none}
.time-line{height:2px;background:var(--red);box-shadow:0 0 8px rgba(239,68,68,.8);position:relative}
.time-dot{position:absolute;left:-5px;top:-4px;width:10px;height:10px;border-radius:50%;background:var(--red);box-shadow:0 0 10px rgba(239,68,68,.9);animation:pulseDot 2s infinite}
.time-label-tag{position:absolute;right:calc(100% + 6px);top:-9px;background:var(--red);color:#fff;font-size:.65rem;font-weight:700;padding:2px 6px;border-radius:4px;white-space:nowrap;box-shadow:0 0 8px rgba(239,68,68,.5);letter-spacing:.3px}

/* CURRENT COURSE BANNER */
.cc-banner{background:linear-gradient(135deg,rgba(91,110,245,.1),rgba(139,92,246,.08));border:1px solid rgba(91,110,245,.22);border-radius:10px;padding:12px 16px;display:flex;align-items:center;gap:14px;margin-bottom:14px;transition:var(--trans)}
.cc-banner:hover{border-color:rgba(91,110,245,.4);box-shadow:0 0 14px rgba(91,110,245,.15)}
.cc-icon-wrap{width:38px;height:38px;border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:1.1rem;flex-shrink:0}
.cc-body{flex:1;min-width:0}.cc-title{font-size:.92rem;font-weight:600}.cc-sub{font-size:.77rem;color:var(--text-muted);margin-top:2px}
.cc-bar-wrap{min-width:150px;max-width:180px;flex-shrink:0}
.cc-bar-bg{background:var(--bg3);border-radius:99px;height:5px;margin-bottom:4px;overflow:hidden}
.cc-bar-fill{height:100%;border-radius:99px;background:linear-gradient(90deg,var(--accent),var(--accent2));transition:width .5s}
.cc-pct{font-size:.7rem;color:var(--text-muted);text-align:right}

/* DAY VIEW date header */
.day-view-header{background:var(--bg3);border-bottom:1px solid var(--border);padding:14px 18px;display:flex;align-items:center;gap:12px}
.dv-date-big{font-size:1.8rem;font-weight:800;line-height:1;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.dv-date-info{flex:1}.dv-weekday{font-size:1rem;font-weight:600;color:var(--text)}.dv-month{font-size:.82rem;color:var(--text-muted);margin-top:2px}
.dv-today-badge{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;font-size:.73rem;font-weight:700;padding:3px 10px;border-radius:20px;box-shadow:0 0 10px rgba(91,110,245,.4)}

/* MODAL */
.modal-overlay{position:fixed;inset:0;z-index:100;background:rgba(0,0,0,.65);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;padding:20px;opacity:0;pointer-events:none;transition:opacity .22s}
.modal-overlay.open{opacity:1;pointer-events:all}
.modal{background:var(--bg2);border:1px solid var(--border);border-radius:16px;padding:24px;width:100%;max-width:500px;box-shadow:0 24px 60px rgba(0,0,0,.6),0 0 0 1px rgba(91,110,245,.1);transform:translateY(20px) scale(.97);transition:transform .26s cubic-bezier(.4,0,.2,1)}
.modal-overlay.open .modal{transform:translateY(0) scale(1)}
.modal h2{font-size:1.1rem;font-weight:700;margin-bottom:18px;display:flex;align-items:center;gap:8px}
.form-group{margin-bottom:14px}
.form-group label{display:block;font-size:.8rem;color:var(--text-muted);margin-bottom:6px}
.form-group input,.form-group textarea,.form-group select{width:100%;background:var(--bg3);border:1px solid var(--border);border-radius:8px;padding:9px 12px;color:var(--text);font-size:.88rem;outline:none;transition:var(--trans);font-family:inherit}
.form-group input:focus,.form-group textarea:focus,.form-group select:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(91,110,245,.15)}
.form-group textarea{resize:vertical;min-height:70px}
.form-row{display:flex;gap:10px}.form-row .form-group{flex:1}
.prio-btns{display:flex;gap:8px}
.prio-btn{flex:1;padding:7px 10px;border-radius:7px;border:1px solid var(--border);background:transparent;color:var(--text-muted);font-size:.8rem;cursor:pointer;transition:var(--trans);text-align:center}
.prio-btn:hover{transform:translateY(-1px)}
.prio-btn.sel-high{background:rgba(239,68,68,.15);border-color:var(--red);color:var(--red);box-shadow:0 0 8px rgba(239,68,68,.2)}
.prio-btn.sel-mid{background:rgba(234,179,8,.12);border-color:var(--yellow);color:var(--yellow);box-shadow:0 0 8px rgba(234,179,8,.2)}
.prio-btn.sel-low{background:rgba(34,197,94,.1);border-color:var(--green);color:var(--green);box-shadow:0 0 8px rgba(34,197,94,.2)}
.modal-footer{display:flex;gap:8px;justify-content:flex-end;margin-top:20px}

/* COLOR PICKER */
.color-picker-row{display:flex;gap:8px;flex-wrap:wrap}
.cpick-dot{width:30px;height:30px;border-radius:50%;cursor:pointer;transition:var(--trans);border:2px solid transparent;flex-shrink:0}
.cpick-dot:hover{transform:scale(1.15)}
.cpick-dot.sel{border-color:#fff;box-shadow:0 0 0 2px var(--accent)}

/* DAY PICKER */
.day-picker-row{display:flex;gap:6px;flex-wrap:wrap}
.dpick-btn{width:36px;height:36px;border-radius:8px;border:1px solid var(--border);background:transparent;color:var(--text-muted);font-size:.75rem;font-weight:600;cursor:pointer;transition:var(--trans);display:flex;align-items:center;justify-content:center}
.dpick-btn:hover{border-color:var(--accent);color:var(--text)}
.dpick-btn.on{background:var(--accent);border-color:var(--accent);color:#fff;box-shadow:0 0 8px rgba(91,110,245,.4)}

/* TOAST */
.toast{position:fixed;bottom:24px;right:24px;background:var(--bg3);border:1px solid var(--accent);border-radius:10px;padding:12px 18px;font-size:.85rem;box-shadow:0 0 20px rgba(91,110,245,.3);z-index:200;transform:translateY(80px);opacity:0;transition:transform .3s cubic-bezier(.4,0,.2,1),opacity .3s;display:flex;align-items:center;gap:8px}
.toast.show{transform:translateY(0);opacity:1}
.toast.success{border-color:var(--green);box-shadow:0 0 20px rgba(34,197,94,.25)}

.empty-state{text-align:center;padding:40px 20px;color:var(--text-dim)}
.empty-state .emoji{font-size:2.2rem;margin-bottom:10px}
.empty-state p{font-size:.85rem}
</style>
</head>
<body>
<div class="page">

  <div class="header">
    <div class="header-left">
      <h1><span class="icon-badge">üìÖ</span> Planner</h1>
      <p>Dein Weg zur Pr√ºfung ‚Äì strukturiert, fokussiert, erfolgreich</p>
    </div>
    <div class="header-right">
      <div class="streak-badge"><div class="num">5</div><div class="label">Tage<span>Streak üî•</span></div></div>
      <button class="btn btn-primary" onclick="openModal('task')">‚ú¶ Aufgabe</button>
    </div>
  </div>

  <div class="stats-grid">
    <div class="stat-card"><div class="val" style="color:var(--red)" id="statOverdue">0</div><div class="lbl">√úberf√§llig</div><div class="sub bad">‚ö† Sofort erledigen</div></div>
    <div class="stat-card"><div class="val" style="color:var(--yellow)" id="statToday">0</div><div class="lbl">Heute f√§llig</div><div class="sub warn">üìÖ Heute</div></div>
    <div class="stat-card"><div class="val" style="color:var(--green)" id="statDone">0</div><div class="lbl">Erledigt</div><div class="sub good">‚úì Diese Woche</div></div>
    <div class="stat-card"><div class="val" style="color:var(--accent)" id="statTotal">0</div><div class="lbl">Gesamt offen</div><div class="sub" style="color:var(--text-muted)">üìã Alle</div></div>
  </div>

  <div class="focus-banner">
    <div class="focus-timer" id="focusTimer">25:00</div>
    <div class="focus-info"><div class="focus-label">üçÖ Pomodoro-Fokus</div><div class="focus-task" id="focusTaskName">Klick auf eine Aufgabe um den Fokus zu starten</div></div>
    <div style="display:flex;gap:8px;flex-shrink:0">
      <button class="btn btn-primary" id="focusBtn" onclick="toggleFocus()">‚ñ∂ Start</button>
      <button class="btn btn-ghost" onclick="resetFocus()">‚Ü∫</button>
    </div>
  </div>

  <div class="toolbar">
    <div class="search-wrap"><span class="ico">üîç</span><input type="text" id="searchInput" placeholder="Aufgaben durchsuchen..." oninput="renderTasks()"></div>
    <select class="filter-select" id="filterPrio" onchange="renderTasks()"><option value="">Alle Priorit√§ten</option><option value="high">üî¥ Hoch</option><option value="mid">üü° Mittel</option><option value="low">üü¢ Niedrig</option></select>
    <select class="filter-select" id="filterCat" onchange="renderTasks()"><option value="">Alle F√§cher</option><option>Mathe</option><option>Physik</option><option>Informatik</option><option>Chemie</option><option>Sonstiges</option></select>
  </div>

  <div class="tabs">
    <button class="tab-btn active" data-tab="aufgaben" onclick="switchTab(this)">üìã Aufgaben</button>
    <button class="tab-btn" data-tab="kalender" onclick="switchTab(this)">üìÜ Kalender</button>
    <button class="tab-btn" data-tab="woche" onclick="switchTab(this)">üóì Wochenansicht</button>
    <button class="tab-btn" data-tab="stundenplan" onclick="switchTab(this)">üè´ Stundenplan</button>
    <button class="tab-btn" data-tab="ziele" onclick="switchTab(this)">üéØ Ziele</button>
    <button class="tab-btn" data-tab="habits" onclick="switchTab(this)">‚ö° Habits</button>
  </div>

  <!-- AUFGABEN -->
  <div class="panel active" id="panel-aufgaben">
    <div style="display:flex;flex-direction:column;gap:22px">
      <div>
        <div class="section-header"><span class="section-title">Heute</span><span style="font-size:.8rem;color:var(--text-muted)" id="todayDate"></span></div>
        <div class="tasks-list" id="list-today"></div>
        <button class="btn-add-task" style="margin-top:8px" onclick="openModal('task','today')"><span class="plus">+</span> Aufgabe f√ºr heute</button>
      </div>
      <div>
        <div class="section-header"><span class="section-title">Demn√§chst</span></div>
        <div class="tasks-list" id="list-upcoming"></div>
        <button class="btn-add-task" style="margin-top:8px" onclick="openModal('task')"><span class="plus">+</span> Aufgabe hinzuf√ºgen</button>
      </div>
      <div>
        <div class="section-header"><span class="section-title">Erledigt</span><button class="btn btn-ghost btn-sm" onclick="clearDone()">Leeren</button></div>
        <div class="tasks-list" id="list-done"></div>
      </div>
    </div>
  </div>

  <!-- KALENDER -->
  <div class="panel" id="panel-kalender">
    <div class="cal-wrap">
      <div class="cal-nav"><button onclick="calPrev()">‚Äπ</button><div class="month-label" id="calMonthLabel"></div><button onclick="calNext()">‚Ä∫</button></div>
      <div class="cal-weekdays"><div>Mo</div><div>Di</div><div>Mi</div><div>Do</div><div>Fr</div><div style="color:var(--accent)">Sa</div><div style="color:var(--red)">So</div></div>
      <div class="cal-grid" id="calGrid"></div>
    </div>
  </div>

  <!-- WOCHE TASKS -->
  <div class="panel" id="panel-woche">
    <div class="section-header" style="margin-bottom:14px">
      <span class="section-title" id="weekLabel">Diese Woche</span>
      <div style="display:flex;gap:8px">
        <button class="btn btn-ghost btn-sm" onclick="weekOffset--;renderWeek()">‚Äπ Zur√ºck</button>
        <button class="btn btn-ghost btn-sm" onclick="weekOffset=0;renderWeek()">Heute</button>
        <button class="btn btn-ghost btn-sm" onclick="weekOffset++;renderWeek()">Vor ‚Ä∫</button>
      </div>
    </div>
    <div style="overflow-x:auto"><div class="week-grid" id="weekGrid"></div></div>
  </div>

  <!-- STUNDENPLAN -->
  <div class="panel" id="panel-stundenplan">
    <div id="ccBannerWrap"></div>
    <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px;margin-bottom:14px">
      <div class="sub-tabs">
        <button class="sub-tab active" data-sp="tag" onclick="switchSpTab(this)">üìÖ Tag</button>
        <button class="sub-tab" data-sp="spwoche" onclick="switchSpTab(this)">üóì Woche</button>
      </div>
      <button class="btn btn-primary" onclick="openModal('kurs')">+ Kurs hinzuf√ºgen</button>
    </div>

    <!-- TAG VIEW -->
    <div class="sp-panel active" id="sp-tag">
      <div class="sp-nav">
        <div class="sp-nav-center">
          <button class="sp-nav-btn" onclick="dayOff--;renderDayView()">‚Äπ</button>
          <div class="sp-date-label" id="dayNavLabel">‚Äì</div>
          <button class="sp-nav-btn" onclick="dayOff++;renderDayView()">‚Ä∫</button>
        </div>
        <div style="display:flex;align-items:center;gap:8px">
          <div class="now-chip"><span class="dot"></span><span id="nowTimeText">--:--</span> Uhr</div>
          <button class="today-chip" onclick="dayOff=0;renderDayView()">Heute</button>
        </div>
      </div>
      <div class="schedule-wrap" id="dayScheduleWrap">
        <!-- built by JS -->
      </div>
    </div>

    <!-- WEEK VIEW -->
    <div class="sp-panel" id="sp-spwoche">
      <div class="sp-nav">
        <div class="sp-nav-center">
          <button class="sp-nav-btn" onclick="spWeekOff--;renderSpWeek()">‚Äπ</button>
          <div class="sp-date-label" id="spWeekNavLabel">‚Äì</div>
          <button class="sp-nav-btn" onclick="spWeekOff++;renderSpWeek()">‚Ä∫</button>
        </div>
        <button class="today-chip" onclick="spWeekOff=0;renderSpWeek()">Heute</button>
      </div>
      <div class="schedule-wrap" id="spWeekWrap">
        <!-- built by JS -->
      </div>
    </div>
  </div>

  <!-- ZIELE -->
  <div class="panel" id="panel-ziele">
    <div class="goals-summary" id="goalsSummary"></div>
    <div class="goals-layout" id="goalsGrid"></div>
  </div>

  <!-- HABITS -->
  <div class="panel" id="panel-habits">
    <div class="section-header"><span class="section-title">T√§gliche Gewohnheiten</span><button class="btn btn-primary" onclick="openModal('habit')">+ Habit</button></div>
    <div id="habitsList"></div>
  </div>
</div>

<!-- MODAL TASK -->
<div class="modal-overlay" id="modal-task">
  <div class="modal">
    <h2>‚ú¶ Neue Aufgabe</h2>
    <div class="form-group"><label>Titel</label><input type="text" id="taskTitleInput" placeholder="z.B. Analysis √úbungsblatt 4"></div>
    <div class="form-row">
      <div class="form-group"><label>Fach</label><select id="taskCatInput"><option>Mathe</option><option>Physik</option><option>Informatik</option><option>Chemie</option><option>Sonstiges</option></select></div>
      <div class="form-group"><label>F√§llig am</label><input type="date" id="taskDueInput"></div>
    </div>
    <div class="form-group"><label>Priorit√§t</label>
      <div class="prio-btns"><button class="prio-btn sel-high" data-p="high" onclick="setPrio(this)">üî¥ Hoch</button><button class="prio-btn" data-p="mid" onclick="setPrio(this)">üü° Mittel</button><button class="prio-btn" data-p="low" onclick="setPrio(this)">üü¢ Niedrig</button></div>
    </div>
    <div class="form-group"><label>Notiz</label><textarea id="taskNoteInput" placeholder="Kapitel, Seiten..."></textarea></div>
    <div class="modal-footer"><button class="btn btn-ghost" onclick="closeModal('task')">Abbrechen</button><button class="btn btn-primary" onclick="saveTask()">üíæ Speichern</button></div>
  </div>
</div>

<!-- MODAL KURS -->
<div class="modal-overlay" id="modal-kurs">
  <div class="modal">
    <h2>üè´ Kurs hinzuf√ºgen</h2>
    <div class="form-row">
      <div class="form-group" style="flex:2"><label>Kursname</label><input type="text" id="kursNameInput" placeholder="z.B. Analysis II"></div>
      <div class="form-group"><label>Raum</label><input type="text" id="kursRoomInput" placeholder="z.B. H1"></div>
    </div>
    <div class="form-group"><label>Dozent (optional)</label><input type="text" id="kursDozentInput" placeholder="z.B. Prof. M√ºller"></div>
    <div class="form-group">
      <label>Wochentage</label>
      <div class="day-picker-row" id="kursDayPicker">
        <button class="dpick-btn" data-d="0">Mo</button><button class="dpick-btn" data-d="1">Di</button><button class="dpick-btn" data-d="2">Mi</button><button class="dpick-btn" data-d="3">Do</button><button class="dpick-btn" data-d="4">Fr</button><button class="dpick-btn" data-d="5">Sa</button><button class="dpick-btn" data-d="6">So</button>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Beginn</label><input type="time" id="kursStartInput" value="08:00"></div>
      <div class="form-group"><label>Ende</label><input type="time" id="kursEndInput" value="10:00"></div>
    </div>
    <div class="form-group"><label>Farbe</label><div class="color-picker-row" id="kursColorPicker"></div></div>
    <div class="modal-footer"><button class="btn btn-ghost" onclick="closeModal('kurs')">Abbrechen</button><button class="btn btn-primary" onclick="saveKurs()">üíæ Speichern</button></div>
  </div>
</div>

<!-- MODAL GOAL -->
<div class="modal-overlay" id="modal-goal">
  <div class="modal">
    <h2>üéØ Neues Ziel</h2>
    <div class="form-group"><label>Ziel-Titel</label><input type="text" id="goalTitleInput" placeholder="z.B. Analysis bestehen"></div>
    <div class="form-row">
      <div class="form-group"><label>Emoji / Icon</label><input type="text" id="goalIconInput" value="üéØ" maxlength="2"></div>
      <div class="form-group"><label>Deadline (optional)</label><input type="date" id="goalDeadlineInput"></div>
    </div>
    <div class="form-group"><label>Farbe</label>
      <div style="display:flex;gap:8px;flex-wrap:wrap" id="goalColorPicker"></div>
    </div>
    <div class="form-group">
      <label>Meilensteine (optional ‚Äì kannst du sp√§ter hinzuf√ºgen)</label>
      <div id="goalMsInputList" style="display:flex;flex-direction:column;gap:6px;margin-bottom:8px"></div>
      <div style="display:flex;gap:8px">
        <input type="text" id="goalMsInput" class="ms-add-input" placeholder="Meilenstein eingeben...">
        <button class="ms-add-btn" onclick="addGoalModalMs()">+ Add</button>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('goal')">Abbrechen</button>
      <button class="btn btn-primary" onclick="saveGoal()">üíæ Speichern</button>
    </div>
  </div>
</div>

<!-- MODAL HABIT -->
<div class="modal-overlay" id="modal-habit">
  <div class="modal">
    <h2>‚ö° Neuer Habit</h2>
    <div class="form-group"><label>Name</label><input type="text" id="habitNameInput" placeholder="z.B. 30 min Lernen"></div>
    <div class="form-row">
      <div class="form-group"><label>Emoji</label><input type="text" id="habitIconInput" value="‚ö°" maxlength="2"></div>
      <div class="form-group"><label>Farbe</label><select id="habitColorInput"><option value="rgba(91,110,245,.18)">Blau</option><option value="rgba(34,197,94,.15)">Gr√ºn</option><option value="rgba(139,92,246,.18)">Lila</option><option value="rgba(234,179,8,.15)">Gelb</option><option value="rgba(239,68,68,.15)">Rot</option></select></div>
    </div>
    <div class="modal-footer"><button class="btn btn-ghost" onclick="closeModal('habit')">Abbrechen</button><button class="btn btn-primary" onclick="saveHabit()">üíæ Speichern</button></div>
  </div>
</div>

<div class="toast" id="toast"><span class="toast-ico">‚úì</span><span id="toastMsg">Gespeichert!</span></div>

<script>
// ‚ïê‚ïê‚ïê CONSTANTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const HOUR_H  = 64;   // px per hour
const START_H = 7;    // 07:00
const END_H   = 22;   // 22:00
const TOTAL_H = END_H - START_H; // 15 hours ‚Üí 960px total

const today = new Date(); today.setHours(0,0,0,0);
const fmt   = d => d.toISOString().split('T')[0];
const addD  = (d,n) => { const r=new Date(d); r.setDate(r.getDate()+n); return r; };
const WD    = ['Mo','Di','Mi','Do','Fr','Sa','So'];
const MON   = ['Januar','Februar','M√§rz','April','Mai','Juni','Juli','August','September','Oktober','November','Dezember'];

const COLORS = {
  blue:  {cls:'ev-blue',  hex:'#5b6ef5'},
  purple:{cls:'ev-purple',hex:'#8b5cf6'},
  green: {cls:'ev-green', hex:'#22c55e'},
  red:   {cls:'ev-red',   hex:'#ef4444'},
  yellow:{cls:'ev-yellow',hex:'#eab308'},
  cyan:  {cls:'ev-cyan',  hex:'#06b6d4'},
  pink:  {cls:'ev-pink',  hex:'#ec4899'},
  orange:{cls:'ev-orange',hex:'#f97316'},
};

// ‚ïê‚ïê‚ïê STATE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let tasks = [
  {id:1,title:'Analysis √úbungsblatt 1',cat:'Mathe',due:fmt(today),prio:'high',done:false,note:'Kapitel 1‚Äì2'},
  {id:2,title:'Beispiel-Aufgabe (erledigt)',cat:'Sonstiges',due:fmt(addD(today,-1)),prio:'low',done:true,note:''},
];
let nextTaskId = 3;

let habits = [
  {id:1,name:'30 min Lernen',icon:'üìö',color:'rgba(91,110,245,.18)',days:[1,0,1,0,1,0,0]},
];
let nextHabitId = 2;

// days = array of weekday indices 0=Mon ‚Ä¶ 6=Sun on which course repeats
let kurse = [
  {id:1,name:'Analysis II',room:'H1 ¬∑ D.105',dozent:'Prof. M√ºller',days:[0,2],start:'08:00',end:'10:00',color:'blue'},
  {id:2,name:'Physik Praktikum',room:'P-Bau 02',dozent:'Prof. Schmidt',days:[4],start:'13:00',end:'16:00',color:'green'},
];
let nextKursId = 3;

let selectedPrio = 'high';
let kDays = [];       // selected days in kurs modal
let kColor = 'blue';  // selected color in kurs modal
let calYear = today.getFullYear(), calMonth = today.getMonth();
let weekOffset = 0;
let dayOff = 0;       // day offset from today for day view
let spWeekOff = 0;    // week offset for sp week view
let focusInterval = null, focusSeconds = 25*60, focusRunning = false;

// ‚ïê‚ïê‚ïê INIT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.addEventListener('DOMContentLoaded', () => {
  document.getElementById('todayDate').textContent =
    today.toLocaleDateString('de-DE',{weekday:'long',day:'numeric',month:'long',year:'numeric'});
  document.getElementById('taskDueInput').value = fmt(today);
  buildColorPickerUI();
  renderTasks(); renderCalendar(); renderWeek();
  renderDayView(); renderSpWeek();
  renderGoals(); renderHabits(); updateStats();
  tickNow();
  setInterval(tickNow, 30000);
});

// ‚ïê‚ïê‚ïê TABS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function switchTab(btn) {
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('panel-'+btn.dataset.tab).classList.add('active');
  if(btn.dataset.tab==='stundenplan'){
    updateCurrentCourseBanner();
    setTimeout(scrollToNow,80);
  }
}
function switchSpTab(btn) {
  document.querySelectorAll('.sub-tab').forEach(b=>b.classList.remove('active'));
  document.querySelectorAll('.sp-panel').forEach(p=>p.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('sp-'+btn.dataset.sp).classList.add('active');
  if(btn.dataset.sp==='tag') setTimeout(scrollToNow,80);
  else setTimeout(scrollToNow,80);
}

// ‚ïê‚ïê‚ïê TASKS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const catC = {Mathe:'tag-blue',Physik:'tag-purple',Informatik:'tag-green',Chemie:'tag-yellow',Sonstiges:'tag-gray'};
function dueCls(s){if(!s)return'';const d=new Date(s);d.setHours(0,0,0,0);if(d<today)return'overdue';if(d.getTime()===today.getTime())return'today';if((d-today)/864e5<=2)return'soon';return'';}
function dueLbl(s){if(!s)return'';const d=new Date(s);d.setHours(0,0,0,0);if(d<today)return`‚ö† ${Math.round((today-d)/864e5)}T √ºberf√§llig`;if(d.getTime()===today.getTime())return'üìÖ Heute';const df=Math.round((d-today)/864e5);return df===1?'‚è∞ Morgen':`in ${df} Tagen`;}
function taskHTML(t){return`<div class="task-card prio-${t.prio||'none'} ${t.done?'done':''}" onclick="focusTask(${t.id})"><div class="task-check ${t.done?'checked':''}" onclick="toggleDone(event,${t.id})"></div><div class="task-body"><div class="task-title">${t.title}</div><div class="task-meta"><span class="tag ${catC[t.cat]||'tag-gray'}">${t.cat}</span><span class="prio-dot ${t.prio}"></span>${t.note?`<span style="font-size:.75rem;color:var(--text-dim)">${t.note}</span>`:''}</div></div><div class="task-due ${dueCls(t.due)}">${dueLbl(t.due)}</div></div>`;}
function renderTasks(){
  const sq=document.getElementById('searchInput').value.toLowerCase();
  const sp=document.getElementById('filterPrio').value;
  const sc=document.getElementById('filterCat').value;
  const f=t=>{if(sq&&!t.title.toLowerCase().includes(sq))return false;if(sp&&t.prio!==sp)return false;if(sc&&t.cat!==sc)return false;return true;};
  const fl=tasks.filter(f);
  const tl=fl.filter(t=>!t.done&&t.due&&new Date(t.due)<=today);
  const up=fl.filter(t=>!t.done&&(!t.due||new Date(t.due)>today));
  const dn=fl.filter(t=>t.done);
  document.getElementById('list-today').innerHTML   =tl.map(taskHTML).join('')||'<div class="empty-state"><div class="emoji">‚úÖ</div><p>Alle heutigen Aufgaben erledigt!</p></div>';
  document.getElementById('list-upcoming').innerHTML=up.map(taskHTML).join('')||'<div class="empty-state"><div class="emoji">üéâ</div><p>Keine weiteren Aufgaben</p></div>';
  document.getElementById('list-done').innerHTML    =dn.map(taskHTML).join('');
  updateStats();
}
function toggleDone(e,id){e.stopPropagation();const t=tasks.find(x=>x.id===id);if(!t)return;t.done=!t.done;if(t.done)showToast('‚úì '+t.title,'success');renderTasks();}
function clearDone(){tasks=tasks.filter(t=>!t.done);renderTasks();showToast('üóë Erledigt geleert');}
function focusTask(id){const t=tasks.find(x=>x.id===id);if(t&&!t.done){document.getElementById('focusTaskName').textContent=t.title;showToast('üéØ Fokus: '+t.title);}}
function updateStats(){
  document.getElementById('statOverdue').textContent=tasks.filter(t=>!t.done&&t.due&&new Date(t.due)<today).length;
  document.getElementById('statToday').textContent  =tasks.filter(t=>!t.done&&t.due&&fmt(new Date(t.due))===fmt(today)).length;
  document.getElementById('statDone').textContent   =tasks.filter(t=>t.done).length;
  document.getElementById('statTotal').textContent  =tasks.filter(t=>!t.done).length;
}

// ‚ïê‚ïê‚ïê MODALS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openModal(type,ctx){
  if(type==='task'){
    document.getElementById('taskTitleInput').value='';
    document.getElementById('taskNoteInput').value='';
    document.getElementById('taskDueInput').value=ctx==='today'?fmt(today):'';
    selectedPrio='high';
    document.querySelectorAll('.prio-btn').forEach(b=>{b.className='prio-btn'+(b.dataset.p==='high'?' sel-high':'');});
  }
  if(type==='kurs'){
    document.getElementById('kursNameInput').value='';
    document.getElementById('kursRoomInput').value='';
    document.getElementById('kursDozentInput').value='';
    document.getElementById('kursStartInput').value='08:00';
    document.getElementById('kursEndInput').value='10:00';
    kDays=[];kColor='blue';
    document.querySelectorAll('.dpick-btn').forEach(b=>b.classList.remove('on'));
    document.querySelectorAll('.cpick-dot').forEach(d=>{d.classList.toggle('sel',d.dataset.c==='blue');});
  }
  document.getElementById('modal-'+type).classList.add('open');
  setTimeout(()=>{
    const el=document.getElementById(type+'NameInput')||document.getElementById(type+'TitleInput');
    if(el)el.focus();
  },100);
}
function closeModal(type){document.getElementById('modal-'+type).classList.remove('open');}
document.querySelectorAll('.modal-overlay').forEach(o=>o.addEventListener('click',e=>{if(e.target===o)o.classList.remove('open');}));

function setPrio(btn){selectedPrio=btn.dataset.p;document.querySelectorAll('.prio-btn').forEach(b=>{b.className='prio-btn';if(b.dataset.p===selectedPrio)b.classList.add('sel-'+selectedPrio);});}
function saveTask(){
  const title=document.getElementById('taskTitleInput').value.trim();
  if(!title){showToast('‚ùå Bitte Titel eingeben');return;}
  tasks.push({id:nextTaskId++,title,cat:document.getElementById('taskCatInput').value,due:document.getElementById('taskDueInput').value,prio:selectedPrio,done:false,note:document.getElementById('taskNoteInput').value.trim()});
  closeModal('task');renderTasks();showToast('‚úì Aufgabe gespeichert!','success');
}

// ‚ïê‚ïê‚ïê CALENDAR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderCalendar(){
  document.getElementById('calMonthLabel').textContent=`${MON[calMonth]} ${calYear}`;
  const grid=document.getElementById('calGrid');grid.innerHTML='';
  const first=new Date(calYear,calMonth,1);let sd=first.getDay();sd=sd===0?6:sd-1;
  const dim=new Date(calYear,calMonth+1,0).getDate(),dip=new Date(calYear,calMonth,0).getDate();
  const cells=[];
  for(let i=sd-1;i>=0;i--)cells.push({day:dip-i,om:true,date:new Date(calYear,calMonth-1,dip-i)});
  for(let d=1;d<=dim;d++)cells.push({day:d,om:false,date:new Date(calYear,calMonth,d)});
  while(cells.length%7!==0)cells.push({day:cells.length-sd-dim+1,om:true,date:null});
  cells.forEach(c=>{
    const div=document.createElement('div');div.className='cal-day'+(c.om?' other-month':'');
    if(c.date&&fmt(c.date)===fmt(today))div.classList.add('today');
    const dt=c.date?tasks.filter(t=>t.due===fmt(c.date)&&!t.done):[];
    div.innerHTML=`<div class="day-num">${c.day}</div>`;
    dt.slice(0,2).forEach(t=>{div.innerHTML+=`<span class="cal-event ${t.prio==='high'?'red':t.prio==='low'?'green':''}">${t.title}</span>`;});
    if(dt.length>2)div.innerHTML+=`<span class="cal-event" style="color:var(--text-dim)">+${dt.length-2}</span>`;
    grid.appendChild(div);
  });
}
function calPrev(){calMonth--;if(calMonth<0){calMonth=11;calYear--;}renderCalendar();}
function calNext(){calMonth++;if(calMonth>11){calMonth=0;calYear++;}renderCalendar();}

// ‚ïê‚ïê‚ïê WEEK TASK VIEW ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function getWS(off){const d=new Date(today);let dow=d.getDay();const mon=dow===0?-6:1-dow;d.setDate(d.getDate()+mon+off*7);return d;}
function renderWeek(){
  const ws=getWS(weekOffset),we=addD(ws,6);
  document.getElementById('weekLabel').textContent=`${ws.toLocaleDateString('de-DE',{day:'numeric',month:'short'})} ‚Äì ${we.toLocaleDateString('de-DE',{day:'numeric',month:'short',year:'numeric'})}`;
  const g=document.getElementById('weekGrid');g.innerHTML='';
  const ts=document.createElement('div');ts.className='week-time-col week-day-header';g.appendChild(ts);
  for(let i=0;i<7;i++){const d=addD(ws,i);const h=document.createElement('div');h.className='week-day-header'+(fmt(d)===fmt(today)?' today':'');h.innerHTML=`<div class="wd-name">${WD[i]}</div><div class="wd-num">${d.getDate()}</div>`;g.appendChild(h);}
  Array.from({length:16},(_,i)=>i+7).forEach(hr=>{
    const tl=document.createElement('div');tl.className='week-time-label';tl.textContent=`${hr}:00`;g.appendChild(tl);
    for(let i=0;i<7;i++){
      const cell=document.createElement('div');cell.className='week-cell';
      tasks.filter(t=>t.due===fmt(addD(ws,i))&&!t.done).forEach((t,idx)=>{
        if((t.prio==='high'?8:t.prio==='mid'?10:12)===hr){
          const ev=document.createElement('div');ev.className=`week-event ${['blue','purple','green','red','yellow'][idx%5]}`;ev.style.top='4px';ev.style.height='38px';ev.textContent=t.title;cell.appendChild(ev);
        }
      });
      g.appendChild(cell);
    }
  });
}

// ‚ïê‚ïê‚ïê STUNDENPLAN HELPERS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const t2m  = t => { const [h,m]=t.split(':').map(Number); return h*60+m; };
const m2px = m => (m - START_H*60) * (HOUR_H/60);
const totalPx = () => TOTAL_H * HOUR_H;

function nowY(){
  const n=new Date(), nm=n.getHours()*60+n.getMinutes();
  if(nm<START_H*60||nm>END_H*60)return null;
  return m2px(nm);
}
function nowStr(){const n=new Date();return `${String(n.getHours()).padStart(2,'0')}:${String(n.getMinutes()).padStart(2,'0')}`;}

function buildGutterEl(){
  const g=document.createElement('div');
  g.className='sch-gutter';
  for(let h=START_H;h<=END_H;h++){
    const lbl=document.createElement('div');lbl.className='sch-hour-label';
    if(h<END_H)lbl.textContent=`${h}:00`;
    g.appendChild(lbl);
  }
  return g;
}

function buildGridLinesInto(el){
  for(let h=0;h<TOTAL_H;h++){
    const l=document.createElement('div');l.className='sch-grid-line';l.style.top=`${h*HOUR_H}px`;el.appendChild(l);
    const lh=document.createElement('div');lh.className='sch-grid-line-half';lh.style.top=`${h*HOUR_H+HOUR_H/2}px`;el.appendChild(lh);
  }
}

function makeEvEl(k, narrowMode){
  const sm=t2m(k.start), em=t2m(k.end);
  const topPx=m2px(sm), hPx=Math.max((em-sm)*(HOUR_H/60),24);
  const col=COLORS[k.color]||COLORS.blue;
  const el=document.createElement('div');
  el.className=`sch-event ${col.cls}`;
  el.style.top=`${topPx}px`;el.style.height=`${hPx}px`;
  const showSub=hPx>=48&&!narrowMode;
  const showTime=hPx>=36;
  el.innerHTML=`<div class="ev-title">${k.name}</div>
    ${showSub&&(k.room||k.dozent)?`<div class="ev-sub">${k.room?'üìç'+k.room:''}${k.dozent&&k.room?' ¬∑ ':''}${k.dozent||''}</div>`:''}
    ${showTime?`<div class="ev-time">${k.start}‚Äì${k.end}</div>`:''}
    <button class="ev-delete" onclick="event.stopPropagation();deleteKurs(${k.id})">‚úï</button>`;
  return el;
}

function makeTimeIndicatorEl(){
  const t=document.createElement('div');t.className='time-indicator';
  t.innerHTML=`<div class="time-line"><div class="time-dot"></div><div class="time-label-tag">${nowStr()}</div></div>`;
  return t;
}

function scrollToNow(){
  const y=nowY();if(y===null)return;
  const offset=Math.max(0,y-180);
  document.querySelectorAll('.sch-body').forEach(b=>b.scrollTop=offset);
}

function tickNow(){
  document.getElementById('nowTimeText').textContent=nowStr();
  // update time indicator labels & positions
  document.querySelectorAll('.time-indicator').forEach(ind=>{
    const y=nowY();
    if(y===null){ind.style.display='none';return;}
    ind.style.display='';ind.style.top=y+'px';
    const lbl=ind.querySelector('.time-label-tag');
    if(lbl)lbl.textContent=nowStr();
  });
  updateCurrentCourseBanner();
}

// ‚ïê‚ïê‚ïê DAY VIEW ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderDayView(){
  const d=addD(today,dayOff);
  const dow=(d.getDay()===0?6:d.getDay()-1); // 0=Mon
  const isT=fmt(d)===fmt(today);

  // nav label
  document.getElementById('dayNavLabel').textContent=
    d.toLocaleDateString('de-DE',{weekday:'long',day:'numeric',month:'long'});

  const wrap=document.getElementById('dayScheduleWrap');
  wrap.innerHTML='';

  // Big date header inside schedule
  const header=document.createElement('div');
  header.className='day-view-header';
  header.innerHTML=`
    <div class="dv-date-big">${d.getDate()}</div>
    <div class="dv-date-info">
      <div class="dv-weekday">${d.toLocaleDateString('de-DE',{weekday:'long'})}</div>
      <div class="dv-month">${MON[d.getMonth()]} ${d.getFullYear()}</div>
    </div>
    ${isT?'<div class="dv-today-badge">Heute</div>':''}
  `;
  wrap.appendChild(header);

  // Scrollable body
  const body=document.createElement('div');body.className='sch-body';body.id='daySchBody';
  const inner=document.createElement('div');inner.className='sch-inner';

  // Gutter
  inner.appendChild(buildGutterEl());

  // Single column
  const col=document.createElement('div');
  col.style.cssText=`flex:1;position:relative;height:${totalPx()}px;min-width:0`;
  buildGridLinesInto(col);

  // Events
  const dayKurse=kurse.filter(k=>k.days.includes(dow));
  dayKurse.forEach(k=>col.appendChild(makeEvEl(k,false)));

  // Time indicator
  if(isT){const y=nowY();if(y!==null){const ind=makeTimeIndicatorEl();ind.style.top=y+'px';col.appendChild(ind);}}

  inner.appendChild(col);body.appendChild(inner);wrap.appendChild(body);
  setTimeout(()=>{if(body)body.scrollTop=Math.max(0,(nowY()||0)-180);},60);
}

// ‚ïê‚ïê‚ïê SP WEEK VIEW ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderSpWeek(){
  const ws=getWS(spWeekOff), we=addD(ws,6);
  document.getElementById('spWeekNavLabel').textContent=
    `${ws.toLocaleDateString('de-DE',{day:'numeric',month:'short'})} ‚Äì ${we.toLocaleDateString('de-DE',{day:'numeric',month:'short',year:'numeric'})}`;

  const wrap=document.getElementById('spWeekWrap');
  wrap.innerHTML='';

  // Header row
  const hRow=document.createElement('div');hRow.className='sch-header-row';
  const ghd=document.createElement('div');ghd.className='sch-time-gutter-head';hRow.appendChild(ghd);
  for(let i=0;i<7;i++){
    const d=addD(ws,i),isT=fmt(d)===fmt(today);
    const h=document.createElement('div');h.className='sch-col-header'+(isT?' is-today':'');
    h.innerHTML=`<div class="dh-name">${WD[i]}</div><div class="dh-num">${d.getDate()}</div>`;
    h.addEventListener('click',()=>{
      dayOff=Math.round((d-today)/864e5);
      document.querySelectorAll('.sub-tab').forEach(b=>b.classList.remove('active'));
      document.querySelectorAll('.sp-panel').forEach(p=>p.classList.remove('active'));
      document.querySelector('[data-sp="tag"]').classList.add('active');
      document.getElementById('sp-tag').classList.add('active');
      renderDayView();setTimeout(scrollToNow,80);
    });
    hRow.appendChild(h);
  }
  wrap.appendChild(hRow);

  // Scroll body
  const body=document.createElement('div');body.className='sch-body';body.id='spWeekSchBody';
  const inner=document.createElement('div');inner.className='sch-inner';
  inner.style.position='relative';

  // Gutter
  inner.appendChild(buildGutterEl());

  // 7 day columns container (position:relative for absolute children)
  const colsWrap=document.createElement('div');
  colsWrap.style.cssText=`flex:1;position:relative;height:${totalPx()}px;display:flex;min-width:0`;

  // Grid lines behind
  const gridBg=document.createElement('div');
  gridBg.style.cssText='position:absolute;inset:0;pointer-events:none';
  buildGridLinesInto(gridBg);
  colsWrap.appendChild(gridBg);

  for(let i=0;i<7;i++){
    const d=addD(ws,i);const isT=fmt(d)===fmt(today);const dow=i;
    const col=document.createElement('div');
    col.className='sch-day-col'+(isT?' is-today':'');
    col.style.cssText=`flex:1;position:relative;border-right:1px solid var(--border);min-width:0`;
    if(i===6)col.style.borderRight='none';
    kurse.filter(k=>k.days.includes(dow)).forEach(k=>col.appendChild(makeEvEl(k,true)));
    colsWrap.appendChild(col);
  }

  // Time indicator for current week
  const todayCol=(()=>{const d=Math.round((today-getWS(spWeekOff))/864e5);return d>=0&&d<7?d:-1;})();
  if(todayCol>=0){const y=nowY();if(y!==null){const ind=makeTimeIndicatorEl();ind.style.cssText=`position:absolute;left:0;right:0;top:${y}px;z-index:20;pointer-events:none`;colsWrap.appendChild(ind);}}

  inner.appendChild(colsWrap);body.appendChild(inner);wrap.appendChild(body);
  setTimeout(()=>{if(body)body.scrollTop=Math.max(0,(nowY()||0)-180);},60);
}

// ‚ïê‚ïê‚ïê CURRENT COURSE BANNER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateCurrentCourseBanner(){
  const now=new Date();
  const nm=now.getHours()*60+now.getMinutes();
  const dow=(now.getDay()===0?6:now.getDay()-1);
  const active=kurse.find(k=>k.days.includes(dow)&&t2m(k.start)<=nm&&t2m(k.end)>nm);
  const wrap=document.getElementById('ccBannerWrap');
  if(!active){wrap.innerHTML='';return;}
  const elapsed=nm-t2m(active.start);
  const total=t2m(active.end)-t2m(active.start);
  const pct=Math.round((elapsed/total)*100);
  const rem=t2m(active.end)-nm;
  const col=COLORS[active.color]||COLORS.blue;
  const emoji={blue:'üìò',purple:'üîÆ',green:'üåø',red:'üî¥',yellow:'‚≠ê',cyan:'üíé',pink:'üå∏',orange:'üçä'}[active.color]||'üìö';
  wrap.innerHTML=`<div class="cc-banner">
    <div class="cc-icon-wrap" style="background:${col.hex}22;border:1px solid ${col.hex}44">${emoji}</div>
    <div class="cc-body">
      <div class="cc-title">üü¢ Jetzt: ${active.name}</div>
      <div class="cc-sub">üìç ${active.room||'‚Äì'} ¬∑ noch ${rem} min ¬∑ ${active.start}‚Äì${active.end}${active.dozent?` ¬∑ ${active.dozent}`:''}</div>
    </div>
    <div class="cc-bar-wrap">
      <div class="cc-bar-bg"><div class="cc-bar-fill" style="width:${pct}%"></div></div>
      <div class="cc-pct">${pct}% vergangen</div>
    </div>
  </div>`;
}

// ‚ïê‚ïê‚ïê KURS CRUD ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildColorPickerUI(){
  const cp=document.getElementById('kursColorPicker');cp.innerHTML='';
  Object.entries(COLORS).forEach(([k,v])=>{
    const d=document.createElement('div');
    d.className='cpick-dot'+(k==='blue'?' sel':'');
    d.dataset.c=k;d.style.background=v.hex;d.title=k;
    d.addEventListener('click',()=>{kColor=k;document.querySelectorAll('.cpick-dot').forEach(x=>x.classList.remove('sel'));d.classList.add('sel');});
    cp.appendChild(d);
  });
}
document.getElementById('kursDayPicker').addEventListener('click',e=>{
  const btn=e.target.closest('.dpick-btn');if(!btn)return;
  const d=Number(btn.dataset.d);
  if(kDays.includes(d)){kDays=kDays.filter(x=>x!==d);btn.classList.remove('on');}
  else{kDays.push(d);btn.classList.add('on');}
});
function saveKurs(){
  const name=document.getElementById('kursNameInput').value.trim();
  if(!name){showToast('‚ùå Bitte Kursname eingeben');return;}
  if(!kDays.length){showToast('‚ùå Bitte mindestens einen Tag w√§hlen');return;}
  const s=document.getElementById('kursStartInput').value;
  const e=document.getElementById('kursEndInput').value;
  if(s>=e){showToast('‚ùå Endzeit muss nach Startzeit liegen');return;}
  kurse.push({id:nextKursId++,name,room:document.getElementById('kursRoomInput').value.trim(),dozent:document.getElementById('kursDozentInput').value.trim(),days:[...kDays],start:s,end:e,color:kColor});
  closeModal('kurs');renderDayView();renderSpWeek();
  showToast('‚úì Kurs gespeichert!','success');
}
function deleteKurs(id){
  kurse=kurse.filter(k=>k.id!==id);
  renderDayView();renderSpWeek();
  showToast('üóë Kurs entfernt');
}

// ‚ïê‚ïê‚ïê GOALS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const GOAL_COLORS = [
  {key:'blue',  hex:'#5b6ef5', bg:'rgba(91,110,245,.18)',  bar:'linear-gradient(90deg,#5b6ef5,#8b5cf6)'},
  {key:'purple',hex:'#8b5cf6', bg:'rgba(139,92,246,.18)',  bar:'linear-gradient(90deg,#8b5cf6,#ec4899)'},
  {key:'green', hex:'#22c55e', bg:'rgba(34,197,94,.15)',   bar:'linear-gradient(90deg,#22c55e,#06b6d4)'},
  {key:'red',   hex:'#ef4444', bg:'rgba(239,68,68,.15)',   bar:'linear-gradient(90deg,#ef4444,#f97316)'},
  {key:'yellow',hex:'#eab308', bg:'rgba(234,179,8,.15)',   bar:'linear-gradient(90deg,#eab308,#f97316)'},
  {key:'cyan',  hex:'#06b6d4', bg:'rgba(6,182,212,.15)',   bar:'linear-gradient(90deg,#06b6d4,#5b6ef5)'},
  {key:'pink',  hex:'#ec4899', bg:'rgba(236,72,153,.15)',  bar:'linear-gradient(90deg,#ec4899,#8b5cf6)'},
  {key:'orange',hex:'#f97316', bg:'rgba(249,115,22,.15)',  bar:'linear-gradient(90deg,#f97316,#eab308)'},
];

let goals = [
  {id:1, title:'Erstes Ziel ‚Äì hier klicken!', icon:'üéØ', color:'blue', deadline:fmt(addD(today,30)),
    milestones:[
      {id:1,text:'Meilenstein 1 (abgehakt)', done:true},
      {id:2,text:'Meilenstein 2 (offen)',   done:false},
    ]},
];
let nextGoalId = 2;
let nextMsId   = 100;
let goalColor  = 'blue';
let modalMsList = [];  // milestones being added in modal

function goalPct(g){
  if(!g.milestones.length) return 0;
  return Math.round(g.milestones.filter(m=>m.done).length / g.milestones.length * 100);
}
function deadlineInfo(dl){
  if(!dl) return {text:'Kein Datum',cls:''};
  const d=new Date(dl);d.setHours(0,0,0,0);
  const diff=Math.round((d-today)/864e5);
  if(diff<0) return {text:`${Math.abs(diff)}T √ºberf√§llig`,cls:'overdue'};
  if(diff===0) return {text:'Heute f√§llig!',cls:'urgent'};
  if(diff<=3) return {text:`${diff} Tage noch`,cls:'urgent'};
  if(diff<=7) return {text:`${diff} Tage noch`,cls:'soon'};
  return {text:`${diff} Tage noch`,cls:''};
}

function buildGoalColorPicker(){
  const cp=document.getElementById('goalColorPicker');
  if(!cp)return;cp.innerHTML='';
  GOAL_COLORS.forEach(c=>{
    const d=document.createElement('div');
    d.className='cpick-dot'+(c.key==='blue'?' sel':'');
    d.style.cssText=`width:28px;height:28px;border-radius:50%;background:${c.hex};cursor:pointer;transition:var(--trans);border:2px solid transparent;flex-shrink:0`;
    d.dataset.c=c.key;d.title=c.key;
    d.addEventListener('click',()=>{
      goalColor=c.key;
      document.querySelectorAll('#goalColorPicker .cpick-dot').forEach(x=>{x.style.borderColor='transparent';x.style.boxShadow='none';});
      d.style.borderColor='#fff';d.style.boxShadow=`0 0 0 2px ${c.hex}`;
    });
    cp.appendChild(d);
  });
}

function addGoalModalMs(){
  const inp=document.getElementById('goalMsInput');
  const txt=inp.value.trim();if(!txt)return;
  modalMsList.push({id:nextMsId++,text:txt,done:false});
  inp.value='';
  renderModalMsList();
  inp.focus();
}
function removeModalMs(id){
  modalMsList=modalMsList.filter(m=>m.id!==id);
  renderModalMsList();
}
function renderModalMsList(){
  const el=document.getElementById('goalMsInputList');if(!el)return;
  el.innerHTML=modalMsList.map(m=>`
    <div style="display:flex;align-items:center;gap:8px;background:var(--bg3);border:1px solid var(--border);border-radius:7px;padding:7px 10px;font-size:.83rem">
      <span style="flex:1;color:var(--text)">${m.text}</span>
      <button onclick="removeModalMs(${m.id})" style="background:none;border:none;color:var(--text-dim);cursor:pointer;font-size:.8rem;padding:0 3px" title="Entfernen">‚úï</button>
    </div>`).join('');
}

document.addEventListener('keydown',e=>{
  if(e.key==='Enter'&&document.activeElement?.id==='goalMsInput'){e.preventDefault();addGoalModalMs();}
});

function openGoalModal(){
  goalColor='blue';modalMsList=[];
  document.getElementById('goalTitleInput').value='';
  document.getElementById('goalIconInput').value='üéØ';
  document.getElementById('goalDeadlineInput').value='';
  document.getElementById('goalMsInputList').innerHTML='';
  document.getElementById('goalMsInput').value='';
  buildGoalColorPicker();
  openModal('goal');
}

function saveGoal(){
  const t=document.getElementById('goalTitleInput').value.trim();
  if(!t){showToast('‚ùå Bitte Titel eingeben');return;}
  goals.push({
    id:nextGoalId++,
    title:t,
    icon:document.getElementById('goalIconInput').value||'üéØ',
    color:goalColor,
    deadline:document.getElementById('goalDeadlineInput').value,
    milestones:[...modalMsList],
  });
  closeModal('goal');renderGoals();showToast('‚úì Ziel erstellt!','success');
}

function toggleMilestone(gid, mid){
  const g=goals.find(x=>x.id===gid);if(!g)return;
  const m=g.milestones.find(x=>x.id===mid);if(!m)return;
  m.done=!m.done;
  if(m.done && goalPct(g)===100) showToast('üèÜ Ziel erreicht: '+g.title,'success');
  else if(m.done) showToast('‚úì Meilenstein abgehakt!','success');
  renderGoals();
  // keep card expanded
  setTimeout(()=>{
    const detail=document.getElementById(`gd-${gid}`);
    const btn=document.getElementById(`ge-${gid}`);
    if(detail){detail.classList.add('open');if(btn)btn.classList.add('open');}
  },10);
}

function addMilestone(gid){
  const inp=document.getElementById(`ms-inp-${gid}`);
  if(!inp)return;const txt=inp.value.trim();if(!txt)return;
  const g=goals.find(x=>x.id===gid);if(!g)return;
  g.milestones.push({id:nextMsId++,text:txt,done:false});
  inp.value='';renderGoals();
  setTimeout(()=>{
    const detail=document.getElementById(`gd-${gid}`);
    const btn=document.getElementById(`ge-${gid}`);
    if(detail){detail.classList.add('open');if(btn)btn.classList.add('open');}
    document.getElementById(`ms-inp-${gid}`)?.focus();
  },10);
}

function deleteMilestone(gid,mid){
  const g=goals.find(x=>x.id===gid);if(!g)return;
  g.milestones=g.milestones.filter(m=>m.id!==mid);
  renderGoals();
  setTimeout(()=>{
    const detail=document.getElementById(`gd-${gid}`);
    const btn=document.getElementById(`ge-${gid}`);
    if(detail){detail.classList.add('open');if(btn)btn.classList.add('open');}
  },10);
}

function deleteGoal(gid){
  if(!confirm('Ziel wirklich l√∂schen?'))return;
  goals=goals.filter(g=>g.id!==gid);
  renderGoals();showToast('üóë Ziel gel√∂scht');
}

function toggleGoalExpand(gid){
  const detail=document.getElementById(`gd-${gid}`);
  const btn=document.getElementById(`ge-${gid}`);
  if(!detail)return;
  const opening=!detail.classList.contains('open');
  detail.classList.toggle('open');
  if(btn)btn.classList.toggle('open');
  // focus input when opening
  if(opening) setTimeout(()=>document.getElementById(`ms-inp-${gid}`)?.focus(),150);
}

// SVG ring helper (r=20, circumference‚âà125.7)
function ringHTML(pct, color){
  const R=20, C=2*Math.PI*R;
  const offset=C-(pct/100)*C;
  return `<svg width="48" height="48" viewBox="0 0 48 48">
    <circle class="goal-ring-bg" cx="24" cy="24" r="${R}"/>
    <circle class="goal-ring-fill" cx="24" cy="24" r="${R}"
      stroke="${color}" stroke-dasharray="${C}" stroke-dashoffset="${offset}"/>
  </svg>`;
}

function renderGoals(){
  // summary chips
  const total=goals.length;
  const done=goals.filter(g=>goalPct(g)===100).length;
  const overdue=goals.filter(g=>g.deadline&&goalPct(g)<100&&new Date(g.deadline)<today).length;
  document.getElementById('goalsSummary').innerHTML=`
    <div class="gs-chip"><div class="gs-num" style="color:var(--accent)">${total}</div><div class="gs-lbl">Ziele gesamt</div></div>
    <div class="gs-chip"><div class="gs-num" style="color:var(--green)">${done}</div><div class="gs-lbl">Erreicht üèÜ</div></div>
    <div class="gs-chip"><div class="gs-num" style="color:var(--red)">${overdue}</div><div class="gs-lbl">√úberf√§llig ‚ö†</div></div>
    <div class="gs-chip"><div class="gs-num" style="color:var(--yellow)">${total-done-overdue}</div><div class="gs-lbl">In Arbeit</div></div>
  `;

  const grid=document.getElementById('goalsGrid');
  grid.innerHTML='';

  goals.forEach(g=>{
    const pct=goalPct(g);
    const completed=pct===100;
    const col=GOAL_COLORS.find(c=>c.key===g.color)||GOAL_COLORS[0];
    const dl=deadlineInfo(g.deadline);
    const doneCnt=g.milestones.filter(m=>m.done).length;
    const totalMs=g.milestones.length;

    // preview: show first 3 milestones
    const previewMs=g.milestones.slice(0,3);
    const moreMs=g.milestones.length-3;

    const card=document.createElement('div');
    card.className=`goal-card${completed?' completed':''}`;
    card.innerHTML=`
      <div class="goal-strip" style="background:${col.hex}"></div>
      <div class="goal-main">
        <div class="goal-head">
          <div class="goal-icon" style="background:${col.bg}">${g.icon}</div>
          <div class="goal-info">
            <div class="goal-title">
              ${g.title}
              ${completed?'<span class="goal-done-badge">üèÜ Erreicht!</span>':''}
            </div>
            ${g.deadline?`<div class="goal-deadline ${dl.cls}">üìÖ ${dl.text}</div>`:'<div class="goal-deadline" style="color:var(--text-dim)">Kein Datum</div>'}
          </div>
        </div>
        <div class="goal-progress-row">
          <div class="goal-ring-wrap">
            ${ringHTML(pct, col.hex)}
            <div class="goal-ring-pct" style="color:${col.hex}">${pct}%</div>
          </div>
          <div class="goal-progress-bar-col">
            <div class="goal-bar-bg"><div class="goal-bar-fill" style="width:${pct}%;background:${col.bar}"></div></div>
            <div class="goal-bar-info">
              <span>${totalMs>0?`${doneCnt}/${totalMs} Meilensteine`:'Keine Meilensteine'}</span>
              <span style="${pct===100?'color:var(--green)':''}">${pct===100?'Fertig! ‚úì':'offen'}</span>
            </div>
          </div>
        </div>
      </div>
      ${previewMs.length?`
      <div class="goal-milestones-preview">
        ${previewMs.map(m=>`
          <div class="ms-preview-item ${m.done?'done-ms':''}" onclick="event.stopPropagation();toggleMilestone(${g.id},${m.id})">
            <div class="ms-mini-check ${m.done?'checked':''}"></div>
            <span>${m.text}</span>
          </div>`).join('')}
        ${moreMs>0?`<div class="ms-more">+${moreMs} weitere</div>`:''}
      </div>`:''}
      <button class="goal-expand-btn" id="ge-${g.id}" onclick="event.stopPropagation();toggleGoalExpand(${g.id})">
        <span>${g.milestones.length?'Alle Meilensteine':'Meilensteine hinzuf√ºgen'}</span>
        <span class="chevron">‚ñæ</span>
      </button>
      <div class="goal-detail" id="gd-${g.id}">
        <div class="ms-full-list" id="ms-list-${g.id}">
          ${g.milestones.length?g.milestones.map(m=>`
            <div class="ms-item ${m.done?'done-ms':''}" onclick="toggleMilestone(${g.id},${m.id})">
              <div class="ms-check ${m.done?'checked':''}"></div>
              <span class="ms-label">${m.text}</span>
              <button class="ms-delete-btn" onclick="event.stopPropagation();deleteMilestone(${g.id},${m.id})" title="L√∂schen">‚úï</button>
            </div>`).join(''):'<div style="font-size:.82rem;color:var(--text-dim);padding:4px 0">Noch keine Meilensteine ‚Äì f√ºge unten welche hinzu!</div>'}
        </div>
        <div class="ms-add-row">
          <input type="text" class="ms-add-input" id="ms-inp-${g.id}" placeholder="Neuen Meilenstein eingeben..."
            onkeydown="if(event.key==='Enter'){event.preventDefault();addMilestone(${g.id})}">
          <button class="ms-add-btn" onclick="addMilestone(${g.id})">+ Add</button>
        </div>
        <div class="goal-detail-footer">
          <button class="btn-danger-sm" onclick="deleteGoal(${g.id})">üóë Ziel l√∂schen</button>
        </div>
      </div>
    `;
    grid.appendChild(card);
  });

  // new goal card
  const newCard=document.createElement('div');
  newCard.className='goal-card-new';
  newCard.innerHTML=`<div class="big-plus">+</div><span>Neues Ziel erstellen</span>`;
  newCard.onclick=openGoalModal;
  grid.appendChild(newCard);
}

// ‚ïê‚ïê‚ïê HABITS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const DI=['Mo','Di','Mi','Do','Fr','Sa','So'];
const tdow=(()=>{let d=today.getDay();return d===0?6:d-1;})();
function renderHabits(){
  const el=document.getElementById('habitsList');
  if(!habits.length){el.innerHTML='<div class="empty-state"><div class="emoji">‚ö°</div><p>Noch keine Habits</p></div>';return;}
  el.innerHTML=habits.map(h=>`<div class="habit-card"><div class="habit-icon" style="background:${h.color}">${h.icon}</div><div class="habit-body"><div class="habit-name">${h.name}</div><div class="habit-streak">üî• ${h.days.filter(Boolean).length}/7 Tage</div></div><div class="habit-days">${h.days.map((dn,i)=>`<div class="habit-day ${dn?'done':''} ${i===tdow?'today-col':''}" onclick="toggleHabitDay(${h.id},${i})">${DI[i]}</div>`).join('')}</div></div>`).join('');
}
function toggleHabitDay(id,di){const h=habits.find(x=>x.id===id);if(!h)return;h.days[di]=h.days[di]?0:1;renderHabits();if(h.days[di])showToast(`‚úì ${h.name}!`,'success');}
function saveHabit(){const n=document.getElementById('habitNameInput').value.trim();if(!n){showToast('‚ùå Name fehlt');return;}habits.push({id:nextHabitId++,name:n,icon:document.getElementById('habitIconInput').value||'‚ö°',color:document.getElementById('habitColorInput').value,days:[0,0,0,0,0,0,0]});closeModal('habit');renderHabits();showToast('‚úì Habit gespeichert!','success');}

// ‚ïê‚ïê‚ïê POMODORO ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toggleFocus(){
  if(focusRunning){clearInterval(focusInterval);focusRunning=false;document.getElementById('focusBtn').textContent='‚ñ∂ Start';}
  else{focusRunning=true;document.getElementById('focusBtn').textContent='‚è∏ Pause';
    focusInterval=setInterval(()=>{if(focusSeconds<=0){resetFocus();showToast('üçÖ Pomodoro fertig! Pause!','success');return;}focusSeconds--;document.getElementById('focusTimer').textContent=`${String(Math.floor(focusSeconds/60)).padStart(2,'0')}:${String(focusSeconds%60).padStart(2,'0')}`;},1000);}
}
function resetFocus(){clearInterval(focusInterval);focusRunning=false;focusSeconds=25*60;document.getElementById('focusTimer').textContent='25:00';document.getElementById('focusBtn').textContent='‚ñ∂ Start';}

// ‚ïê‚ïê‚ïê TOAST ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let toastT;
function showToast(msg,type=''){
  clearTimeout(toastT);const t=document.getElementById('toast');
  document.getElementById('toastMsg').textContent=msg;
  t.className='toast '+(type==='success'?'success':'');t.classList.add('show');
  toastT=setTimeout(()=>t.classList.remove('show'),2800);
}
</script>
</body>
</html>
